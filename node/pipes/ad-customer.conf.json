{
  "_id": "ad-customer",
  "type": "pipe",
  "source": {
    "type": "conditional",
    "alternatives": {
      "prod": {
        "type": "ldap",
        "system": "ad",
        "attributes": "*",
        "id_attribute": "distinguishedName",
        "page_size": 500,
        "search_base": "ou=Kunder,ou=Grupper,ou=Bouvet,dc=bouvet,dc=no",
        "search_filter": "(objectClass=group)"
      },
      "test": {
        "type": "embedded",
        "entities": [{
          "_id": "CN=Viasat,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no",
          "name": ["Viasat"],
          "cn": ["Viasat"],
          "dSCorePropagationData": ["20170216104401.0Z", "20170216104345.0Z", "20170201191713.0Z", "20170104112709.0Z", "16010714223649.0Z"],
          "distinguishedName": ["CN=Viasat,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no"],
          "groupType": ["-2147483640"],
          "instanceType": ["4"],
          "managedBy": ["CN=Max Manus,OU=Alle Sesam,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "member": ["CN=Max Manus,OU=Alla Stockholm,OU=Alle Sverige,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "objectCategory": ["CN=Group,CN=Schema,CN=Configuration,DC=bouvet,DC=no"],
          "objectClass": ["top", "group"],
          "objectGUID": ["\u000f,ÙONíN®¯Y\u000fb{'"],
          "objectSid": ["\u0001\u0005"],
          "sAMAccountName": ["Viasat"],
          "sAMAccountType": ["268435456"],
          "uSNChanged": ["205701087"],
          "uSNCreated": ["82013957"],
          "whenChanged": ["20170831071925.0Z"],
          "whenCreated": ["20150603094941.0Z"]
        }, {
          "_id": "CN=Arcus,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no",
          "name": ["Arcus"],
          "cn": ["Arcus"],
          "dSCorePropagationData": ["20170216104400.0Z", "20170216104345.0Z", "20170201191712.0Z", "20170104112709.0Z", "16010714223649.0Z"],
          "distinguishedName": ["CN=Arcus,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no"],
          "groupType": ["-2147483640"],
          "instanceType": ["4"],
          "managedBy": ["CN=Max Manus,OU=Alle Sesam,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "member": ["CN=Max Manus,OU=Øst Teknologi og Forvaltning,OU=Øst Virksomhetsstyring,OU=Alle Øst,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no", "CN=Test Tester,OU=Øst Prosjektledelse og Arkitekt,OU=Øst Virksomhetsstyring,OU=Alle Øst,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "objectCategory": ["CN=Group,CN=Schema,CN=Configuration,DC=bouvet,DC=no"],
          "objectClass": ["top", "group"],
          "objectGUID": ["RC-`ewM\u0011Ðu\u0012\u001f\u0002\t"],
          "objectSid": ["\u0001\u0005"],
          "sAMAccountName": ["Arcus"],
          "sAMAccountType": ["268435456"],
          "uSNChanged": ["107486"],
          "uSNCreated": ["60325"],
          "whenChanged": ["20131104104700.0Z"],
          "whenCreated": ["20130708080058.0Z"]
        }, {
          "_id": "CN=Multibrand,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no",
          "name": ["Multibrand"],
          "cn": ["Multibrand"],
          "dSCorePropagationData": ["20170216104401.0Z", "20170216104345.0Z", "20170201191713.0Z", "20170104112709.0Z", "16010714223649.0Z"],
          "description": ["Customer-group"],
          "displayName": ["multibrand"],
          "distinguishedName": ["CN=Multibrand,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no"],
          "groupType": ["-2147483640"],
          "instanceType": ["4"],
          "legacyExchangeDN": ["/o=Bouvet AS/ou=First Administrative Group/cn=Recipients/cn=multibrand"],
          "mail": ["multibrand@bouvet.no"],
          "mailNickname": ["multibrand"],
          "managedBy": ["CN=Max Manus,OU=Alle Sesam,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "member": ["CN=Max Manus,OU=Øst RIA 1,OU=Øst Kundeopplevelse,OU=Alle Øst,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "msExchALObjectVersion": ["34"],
          "msExchGroupExternalMemberCount": ["0"],
          "msExchGroupMemberCount": ["1"],
          "msExchPoliciesIncluded": ["494bb1ce-4e01-49d4-9b47-bf7c70f9870c", "{26491cfc-9e50-4857-861b-0cb8df22b5d7}"],
          "msExchUMDtmfMap": ["emailAddress:6858427263", "lastNameFirstName:6858427263", "firstNameLastName:6858427263"],
          "objectCategory": ["CN=Group,CN=Schema,CN=Configuration,DC=bouvet,DC=no"],
          "objectClass": ["top", "group"],
          "objectGUID": ["ýSºªç<rK¹»SoEýô"],
          "objectSid": ["\u0001\u0005"],
          "proxyAddresses": ["smtp:multibrand@bouvetasa.onmicrosoft.com", "x500:/o=ExchangeLabs/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=0160a5cd473b44c5ae57cdb366c35498-Multibrand", "smtp:multibrand@bouvetasa.mail.onmicrosoft.com", "smtp:multibrand@cellnetwork.no", "X500:/o=Cell Network/ou=Norway/cn=Recipients/cn=Distribusjonslister/cn=Projects/cn=multibrand", "SMTP:multibrand@bouvet.no", "X400:c=us;a= ;p=Bouvet AS;o=Exchange;s=multibrand;"],
          "reportToOriginator": ["TRUE"],
          "sAMAccountName": ["Multibrand"],
          "sAMAccountType": ["268435456"],
          "showInAddressBook": ["CN=All Distribution Lists,CN=All Address Lists,CN=Address Lists Container,CN=Bouvet AS,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=bouvet,DC=no", "CN=Default Global Address List,CN=All Global Address Lists,CN=Address Lists Container,CN=Bouvet AS,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=bouvet,DC=no", "CN=All Groups,CN=All Address Lists,CN=Address Lists Container,CN=Bouvet AS,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=bouvet,DC=no"],
          "textEncodedORAddress": ["X400:C=us;A= ;P=Bouvet AS;O=Exchange;S=multibrand;"],
          "uSNChanged": ["204151033"],
          "uSNCreated": ["56547"],
          "whenChanged": ["20170807152115.0Z"],
          "whenCreated": ["20021122210148.0Z"]
        }, {
          "_id": "CN=Cybernetica,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no",
          "name": ["Cybernetica"],
          "cn": ["Cybernetica"],
          "dSCorePropagationData": ["20170216104400.0Z", "20170216104345.0Z", "20170201191712.0Z", "20170104112709.0Z", "16010714223649.0Z"],
          "distinguishedName": ["CN=Cybernetica,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no"],
          "groupType": ["-2147483646"],
          "instanceType": ["4"],
          "managedBy": ["CN=Max Manus,OU=Alle Sesam,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "objectCategory": ["CN=Group,CN=Schema,CN=Configuration,DC=bouvet,DC=no"],
          "objectClass": ["top", "group"],
          "objectGUID": ["wä|à®ÅK§-Ë\u0011×V\u0003"],
          "objectSid": ["\u0001\u0005"],
          "sAMAccountName": ["Cybernetica"],
          "sAMAccountType": ["268435456"],
          "uSNChanged": ["130738294"],
          "uSNCreated": ["46860"],
          "whenChanged": ["20160222152530.0Z"],
          "whenCreated": ["20111129111326.0Z"]
        }, {
          "_id": "CN=Danica pensjon,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no",
          "name": ["Danica pensjon"],
          "cn": ["Danica pensjon"],
          "dSCorePropagationData": ["20170216104400.0Z", "20170216104345.0Z", "20170201191712.0Z", "20170104112709.0Z", "16010714223649.0Z"],
          "distinguishedName": ["CN=Danica pensjon,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no"],
          "groupType": ["-2147483646"],
          "instanceType": ["4"],
          "managedBy": ["CN=Max Manus,OU=Alle Sesam,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "member": ["CN=Gal Gadot,OU=Nord Felles,OU=Alle Nord,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "objectCategory": ["CN=Group,CN=Schema,CN=Configuration,DC=bouvet,DC=no"],
          "objectClass": ["top", "group"],
          "objectGUID": ["§\fä50®Mµ\u001b·Í\u001d'"],
          "objectSid": ["\u0001\u0005"],
          "sAMAccountName": ["Danica pensjon"],
          "sAMAccountType": ["268435456"],
          "uSNChanged": ["47473"],
          "uSNCreated": ["45969"],
          "whenChanged": ["20131104104510.0Z"],
          "whenCreated": ["20111129111413.0Z"]
        }, {
          "_id": "CN=Statnett,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no",
          "name": ["Statnett"],
          "cn": ["Statnett"],
          "dSCorePropagationData": ["20190228191049.0Z", "20190227130020.0Z", "20180503090102.0Z", "20180503090052.0Z", "16010714223649.0Z"],
          "description": ["Customer-group"],
          "displayName": ["Statnett"],
          "distinguishedName": ["CN=Statnett,OU=Kunder,OU=Grupper,OU=Bouvet,DC=bouvet,DC=no"],
          "groupType": ["-2147483640"],
          "info": ["\\Sectors\\Energy\\Statnett"],
          "instanceType": ["4"],
          "legacyExchangeDN": ["/o=Bouvet AS/ou=First Administrative Group/cn=Recipients/cn=Statnett"],
          "mail": ["Statnett-info@bouvet.no"],
          "mailNickname": ["Statnett-info"],
          "managedBy": ["CN=Max Manus,OU=Alle Sesam,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "member": ["CN=Max Manus,OU=Alla Stockholm,OU=Alle Sverige,OU=Ansatte,OU=Brukere,OU=Bouvet,DC=bouvet,DC=no"],
          "msExchALObjectVersion": ["35"],
          "msExchArbitrationMailbox": ["CN=SystemMailbox{1f05a927-c49b-44a1-8918-304fba0bda7e},CN=Users,DC=bouvet,DC=no"],
          "msExchGroupExternalMemberCount": ["0"],
          "msExchGroupMemberCount": ["122"],
          "msExchPoliciesIncluded": ["494bb1ce-4e01-49d4-9b47-bf7c70f9870c", "{26491cfc-9e50-4857-861b-0cb8df22b5d7}"],
          "msExchRecipientDisplayType": ["1073741833"],
          "msExchUMDtmfMap": ["emailAddress:782863884636", "lastNameFirstName:78286388", "firstNameLastName:78286388"],
          "msExchVersion": ["44220983382016"],
          "objectCategory": ["CN=Group,CN=Schema,CN=Configuration,DC=bouvet,DC=no"],
          "objectClass": ["top", "group"],
          "objectGUID": ["þû\u0004E(uJü?·®4Øç"],
          "objectSid": ["\u0001\u0005"],
          "reportToOriginator": ["TRUE"],
          "sAMAccountName": ["Statnett"],
          "sAMAccountType": ["268435456"],
          "textEncodedORAddress": ["X400:C=us;A= ;P=Bouvet AS;O=Exchange;S=Statnett-info;"],
          "uSNChanged": ["428683604"],
          "uSNCreated": ["25042"],
          "url": ["https://workspace.bouvet.no/kunder/Statnett"],
          "whenChanged": ["20190930220901.0Z"],
          "whenCreated": ["20021122210200.0Z"]
        }]
      }
    },
    "condition": "$ENV(node-env)"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["add", "_id", "_S.objectGUID"],
        ["copy", "*"],
        ["add", "rdf:type",
          ["ni", "bouvet:ad-customer"]
        ]
      ]
    }
  },
  "pump": {
    "cron_expression": "$ENV(ad_cron_slow)"
  }
}
